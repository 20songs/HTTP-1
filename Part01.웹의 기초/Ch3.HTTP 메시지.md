# Part01.HTTP: 웹의 기초

## Chapter.3 HTTP 메시지

### 서론: 3장의 목표

* 3.1 메시지의 흐름
  * 메시지가 어떻게 흘러가는가?
    * 인바운드 / 아웃바운드
    * 항상 다운스트림 방향
* HTTP 메시지의 세 부분(시작줄, 헤더, 개체 본문)
  * 메시지의 각 부분
* 요청과 응답 메시지의 차이
* 요청 메시지가 지원하는 여러 기능(메서드)들
  * 메서드 상세
* 응답 메시지가 반환하는 여러 상태 코드들
  * 상태코드 상세
* 여러 HTTP 헤더들은 무슨 일을 하는가?
  * 헤더 상세



### 3.1 메시지의 흐름

---

* HTTP 메시지
  *  HTTP 애플리케이션 간에 주고받은 데이터의 블록들
* 블록의 구성
  * 텍스트 메타 정보 - 데이터(optional)
* 메시지는 방향성이 존재함
  * 인바운드, 아웃바운드, 업스트림, 다운스트림

#### 3.1.1메시지는 원 서버 방향을 인바운드로 하여 송신된다

* 인바운드와 아웃바운드는 트랜잭션의 방향을 포현하기 위해 사용함
  * 트랜잭션 == 요청 명령 + 응답 결과
* 인바운드
  * From 클라이언트 To 서버
* 아웃바운드
  * From 서버 To 클라이언트

#### 3.1.2 다운스트림으로 흐르는 메시지

* 모든 메시지는 다운스트림으로 흐른다
  * 인바운드 방향(요청)에서 클라이언트에 가까운 프록시는 서버에 가까운 프록시에 대해 업스트림
  * 반대로, 아웃바운드 방향(응답)에서 클라이언트 near 프록시는 서버 near 프록시에 대해 다운스트림
  * 하나의 서버, 프록시, 게이트웨이가 인바운드와 아웃바운드일 때 다운스트림 / 업스트림으로 구분될 수 있음



### 3.2 메시지의 각 부분

---

* HTTP 메시지

  * 단순한 데이터의 구조화된 블록
  * [시작줄] - [헤더] - [본문,optional]

  | 시작줄 | HTTP /1.0 200 OK         |
  | ------ | ------------------------ |
  | 헤더   | Content-type: text/plain |
  |        | Content-length: 19       |
  |        |                          |
  | 본문   | Hi! I'm a message!       |



* 시작줄과 헤더

  * 시작줄과 헤더의 줄 바꿈 문자열

    * 캐리지 리턴(ASCII 13) + 개행 문자(ASCII 10)

    * CRLF

      > Carriage Return (\r)
      >
      > Line Feed(\n)
      >
      > > CR: 커서를 가장 앞으로 옮기기
      > >
      > > LF: 줄 위치를 한 줄 내리기( 타자기의 경우 종이를 한 줄 올림)
      > >
      > > > 유닉스, 리눅스의 경우 줄바꿈으로 LF만 사용하고 있음

  * 줄 바꿈 관련 유의사항

    * 견고한 애플리케이션이라면 CRLF가 아닌 그냥 개행 문자(LF)도 받아들여야 함

  * Text only

    * 이진 데이터 포함 안됨

* 본문
  * 엔티티 본문 == 메시지 본문 == 그냥 '본문'
    * Text & Binary(이진) 데이터 모두를 포함할 수 있음
    * 비어있어도 괜찮음

#### 3.2.1 메시지 문법

> 메시지는 요청/응답의 두 종류

* 요청 메시지 형식

  ```
  <메서드>(space)<요청 URL>(space)<버전>
  <헤더>
  (CRLF 혹은 LF)
  <엔터티 본문> (생략 가능, 이진 데이터 입력 가능)
  ```

  * 메서드

    * 클라이언트의 기대
    * 서버가 리소스에 대해 수행해주길 바라는 동작

  * 요청 URL

    * 요청 대상의 리소스를 지칭하는 완전한 URL

    * 혹은 URL의 일부 구성 요소

      * URL 경로의 구성요소가 동작하려면

        1) 클라이언트와 서버가 직접 대화하고 있고

        2) 경로 구성요소가 리소스를 가리키는 절대 경로일 때

        3) 서버는 URL에서 생략된 호스트/포트를 자신으로 간주할 것

  * 버전

    * `HTTP/<메이저>.<마이너>`
    * 메이저와 마이너는 모두 정수(integer)

* 응답 메시지 형식

  ```
  <버전>(space)<상태 코드>(space)<사유 구절>
  <헤더>
  (CRLF 혹은 LF)
  <엔터티 본문> (생략 가능, 이진 데이터 입력 가능)
  ```

  * 상태 코드
    * 세 자리 숫자로 표현된 요청에 대한 응답 상태
    * 첫번째 자리수는 상태의 일반적 분류에 해당: '성공','에러' 등
  * 사유 구절
    * 오로지 사람에게 읽히기 위한 목적으로 존재함
    * `HTTP/1.0 200 NOT OK` == `HTTP/1.0 200 OK`

* 공통

  * 헤더

    * 이름, 콜론(:) ,선택적인 공백, 값, CRLF가 순서대로 나타나남

      예시: Content-Length: 8572
      		\CRLF

    * **항상 주의할 사항**

      * 본문이 없을 때 헤더의 CRLF를 빠뜨리는 경우가 허다함
      * 이를 대비해 CRLF가 없는 HTTP 메시지를 읽을 수 있어야 함

  * 엔터티 본문

    * 임의의 데이터 블록
    * 생략이 가능함

#### 3.2.2 시작줄

##### 요청줄

* 메서드: 서버에서 어떤 동작이 일어나길 원하는지 설명

  `GET / specials/saw-blade.gif HTTP/1.0`에서 `GET`에 해당

  * 메서드에 따라 본문이 있는 경우와 아닌 경우가 있음

    | 메서드  | 설명                               | 본문 유무 |
    | ------- | ---------------------------------- | --------- |
    | GET     | 문서를 가져온다                    | X         |
    | HEAD    | 문서 중 헤더를 가져온다            | X         |
    | POST    | 서버가 처리할 데이터를 보낸다      | O         |
    | PUT     | 서버에 요청 메시지 본문을 저장한다 | O         |
    | TRACE   | 서버에 도달한느 과정을 추적한다    | X         |
    | OPTIONS | 수행 가능한 메서드를 확인한다      | X         |
    | DELETE  | 문서를 제거한다                    | X         |

  * 이외 표준 메서드와 개발자가 정의하는 확장 메서드가 존재함

* 요청 URL: 동적에 대한 대상을 지칭

  `GET / specials/saw-blade.gif HTTP/1.0`에서 `specials/saw-blade.gif`에 해당

* 버전: 클라이언트의 HTTP 버전

  `GET / specials/saw-blade.gif HTTP/1.0`에서 `HTTP/1.0`에 해당

  * HTTP x.y형식으로 기술
    * x와 y는 정수이며
    * 각 숫자는 따로 비교해야 함
    * HTTP/2.22 > HTTP/2.3 [22와 3을 비교해야 함]
  * 대화 상대에게 능력과 메시지의 형식에 대한 단서를 제공하는 것
  * 버전 번호는 어플리케이션이 지원하는 가장 높은 HTTP 버전을 의미함
    * 때때로 낮은 버전의 어플리케이션이 높은 버전의 요청을 받으면 해당 버전을 응답하는 경우가 왕왕 발생함

* 공백구분

##### 응답줄

* 버전: 응답 메시지의 HTTP 버전

  `HTTP/1.0 200 OK`에서 `HTTP/1.0`에 해당

  * HTTP x.y형식으로 기술
    * x와 y는 정수이며
    * 각 숫자는 따로 비교해야 함
    * HTTP/2.22 > HTTP/2.3 [22와 3을 비교해야 함]
  * 대화 상대에게 능력과 메시지의 형식에 대한 단서를 제공하는 것
  * 버전 번호는 어플리케이션이 지원하는 가장 높은 HTTP 버전을 의미함
    * 때때로 낮은 버전의 어플리케이션이 높은 버전의 요청을 받으면 해당 버전을 응답하는 경우가 왕왕 발생함

* 상태 코드: 수행 결과에 대한 숫자 상태 정보

  `HTTP/1.0 200 OK` 에서 `200`에 해당

  | 전체 범위 | 정의된 범위 | 분류            |
  | --------- | ----------- | --------------- |
  | 100-199   | 100-101     | 정보            |
  | 200-299   | 200-206     | 성공            |
  | 300-399   | 300-305     | 리다이렉션      |
  | 400-499   | 400-415     | 클라이언트 에러 |
  | 500-599   | 500-505     | 서버 에러       |

  * HTTP 프로토콜이 확장되면 새로운 상태코드가 나올 수 있음

* 사유 구절: 수행 상태에 대한 텍스트 상태 정보

  `HTTP/1.0 200 OK` 중 `OK`에 해당함

  * 상태 코드와 일대일 대응
  * HTTP 명세에서 규칙을 제공하지 않는 부분

* 공백 구분 



#### 3.2.3 헤더

* 이름/값 쌍의 목록
  * Content-length: 19
* 어플리케이션은 각각 자유롭게 자신만의 헤더를 만들 수 있음
* 흔시 쓰이는 헤더

| 헤더의 예                                | 설명                           |
| ---------------------------------------- | ------------------------------ |
| Date: Tue, 3 Oct 1997 02:16:03 GMT       | 서버가 응답을 만들어 낸 시각   |
| Content-length: 15040                    | 15,050 바이트의 데이터 크기    |
| Content-type:image/gif                   | GIF 이미지                     |
| Accept: image/gif, image/jpeg, text/html | 받아들일 수 있는 컨텐츠의 타입 |

##### 헤더 분류

* 일반 헤더
* 요청 헤더
* 응답 헤더
* Entity 헤더
  * 본문
* 확장 헤더
  * 명세에 정의되지 않은 새로운 헤더

##### 헤더 여러 줄로 나누기

* 긴 헤더는 여러 줄로 쪼개어 표현할 수 있음

  * 단, 추가 줄은 최소 하나의 스페이스 혹은 탭 문자가 필요함

    HTTP/1.0 200 OK

    Content-Type : image/gif

    Server: Test Server

    ​	**Version 1.0**

#### 3.2.4 엔터티 본문

* HTTP가 수송하도록 설계된 화물

#### 3.2.5 버전 0.9 메시지

* 지나칠 정도로 단순한 HTTP 메시지를 이용하는 버전
  * 여전히 이를 사용하는 클라이언트, 서버, 기타 어플이 있기 때문에
  * HTTP/0.9의 제약에 대해서 인지하고 있어야 함



### 3.3 메서드

---

* 모든 서버가 모든 메서드를 구현하지 않음
* 메서드는 대부분 제한적으로 이용됨
  * DELETE, PUT의 경우 서버에 저장된 리소스와 관련있기 때문에 제한적으로 수행

#### 3.3.1 안전한 메서드(Safe method)

* HTTP요청의 결과로 서버에 어떤 작용이 없는 메서드를 의미함
  * 작용이 없다
    * HTTP 요청의 결과로 인해 서버에서 일어나는 일은 아무것도 없다는 의미
  * 작용의 예시
    * 온라인 쇼핑의 '구매' -> POST 메서드 요청 -> 서버 내 신용카드로 대금이 청구
* 단, 안전한 메서드라 해도 서버에 작용을 유발할 가능성이 존재함
  * 웹 개발자가 어떻게 하느냐에 따라 달린 문제

* 안전하지 않은 메소드
  * 경고 메시지를 통해 요청을 처리함

#### 3.3.2 GET

* 서버에게 리소스를 달라고 요청

  * 가장 흔히 쓰이는 메서드
  * 안전한 메서드

  ```
  GET / seasonal/index-fall.html HTTP/1.1
  Host: www.joes-hardware.com
  Accept: *
  ```

  ```
  HTTP/1.1 200 OK
  Content-Type: text/html
  Context-Length: 617
  
  <HTML>
  ...
  ```

#### 3.3.3 HEAD

* 서버에게 리소스의 헤더를 요청

  * GET과 동작 방식은 같음

* HEAD 만 요청하는 것의 이점

  * 리소스의 내용을 보지 않고, 타입 확인
  * 상태 코드를 통해, 개체 존재 유무 확인
  * 리소스 변경(modified) 여부 확인

* 반드시 서버 개발자는 GET과 헤더의 결과가 일치함을 보장해야 함

  * 따라서, HTTP/1.1버전에서 GET, HEAD 메서드는 반드시 구현해야 함

  ```
  GET / seasonal/index-fall.html HTTP/1.1
  Host: www.joes-hardware.com
  Accept: *
  ```

  ```
  HTTP/1.1 200 OK
  Content-Type: text/html
  Context-Length: 617
  ```

#### 3.3.4 PUT

* 서버에 문서를 쓰는 작업

  * 요청의 본문 내용이 요청 URL의 이름으로 기록됨
    * 새 문서를 만들거나
    * 교체하거나

* 대부분의 경우 로그인을 요구

  ```
  PUT /product-list.txt HTTP/1.1
  Host: www.joes-hardware.com
  Content-type: text/plain
  Content-length: 34
  
  Updated product list coming soon!
  ```

  ```
  HTTP/1.1 201 Created
  Location: www.joes-hardware.com/product-list.txt
  Content-type: text/plain
  Content-length: 47
  
  http://www.joes-hardware.com/product-list.txt
  ```

#### 3.3.5 POST

* 서버에 입력된 데이터를 전송하기 위해 설계
  * HTML의 Form을 지원할 때 흔히 사용함
  * 채워진 폼에 담긴 데이터 => 서버로 전송 => 서버는 다음 처리 장소로 전달
    * 데이터를 처리할 서버 게이트웨이 프로그램 등으로 전달

* PUT은 데이터를 입력하는 목적으로 보내며,
  POST는 데이터를 특정하게 처리하기 위해 서버에 위탁하는 느낌

  ```
  POST /inventory-check.cgi HTTP/1.1
  HOST: www.joes-hardware.com
  Content-Type: text/plain
  Content-Length: 18
  
  item=bandsaw 2647
  ```

  ```
  Server to CGI 프로그램
  CGI 프로그램 수행 결과(Yes) -> Server
  ```

  ```
  HTTP/1.1 200 OK
  Content-Type: text/plain
  Content-Length: 37
  
  The bandsaw model 2647 is in stock!
  ```

  

#### 3.3.6 TRACE

* 클라이언트가 자신의 요청이 서버에 도달했을 때 어떻게 보였는가를 알려줌

  * 메시지는 방화벽, 프락시, 게이트웨이 등의 어플리케이션을 흐름
  * 이 흐름 가운데 HTTP 요청이 수정될 위험, 기회가 존재함

* 작동 방식

  * 목적지 서버에서 루프백 진단 시작
  * 서버는 자신이 받은 요청 메시지를 본문에 넣어 TRACE응답을 돌려줌
  * 클라이언트는 변경 여부 및 사항에 대해 확인 가능

* 용도

  * 주로 진단을 위해 사용
    * 요청이 의도한 요청/응답 연쇄를 거쳐갔는가?
    * 프락시나 다른 어플리케이션은 요청에 어떤 영향을 미치는가?

* 유의사항

  * TRACE는 중간 어플리케이션들이 여러 다른 종류의 요청을 일관되게 다룬다는 가정
    * 프락시는 POST요청을 바로 서버로 통과
    * But          GET 요청의 경우 웹 캐시와 같은 HTTP 어플리케이션에 전송
    * TRACE는 위 두 가지를 구별하는 매커니즘을 제공하지 않음
    * 일반적으로 중간 어플리케이션이 TRACE 요청 처리를 결정함
  * TRACE 요청은 엔터티 본문을 보낼 수 없음
    * TRACE 응답은 엔터티 본문에 서버가 받은 요청을 포함시킴

  ```
  TRACE /product-list.txt HTTP/1.1
  Accept: *
  Host: www.joes-hardware.com
  ```

  ```
  TRACE /product-list.txt HTTP/1.1
  Accept: *
  Host: www.joes-hardware.com
  Via: 1.1proxy3.company.com 			[proxy를 거치며 생성]
  ```

  ```
  HTTP/1.1 200 OK
  Content-Type: text/plain
  Content-Length: 96
  
  TRACE /product-list.txt HTTP/1.1	[본문 내용 = TRACE]
  Accept: *
  Host: www.joes-hardware.com
  Via: 1.1proxy3.company.com
  ```

  ```
  HTTP/1.1 200 OK
  Content-Type: text/plain
  Content-Length: 96
  Via: 1.1proxy3.company.com 			[proxy를 거치며 생성]
  
  TRACE /product-list.txt HTTP/1.1 	[본문 내용 = TRACE]
  Accept: *
  Host: www.joes-hardware.com
  Via: 1.1proxy3.company.com
  ```

#### 3.3.7 OPTIONS

* 웹 서버에게 여러 종류의 지원 범위를 물어봄

  * 서버에게 특정 리소스에 대해 어떤 메서드가 지원되는 지 물어볼 수 있음

  ```
  OPTIONS * HTTP/1.1				[모든 리소스에 대해 요청합니다]
  Host: www.joes-hardware.com
  Accept: *
  ```

  ```
  HTTP/1.1 200 OK
  Allow: GET, POST, PUT, OPTIONS		[지원하는 메서드 목록 반환]
  Context-length: 0
  ```

#### 3.3.8 DELETE

* 요청 URL로 지정한 리소스를 삭제 요청

  * 단, 삭제가 수행되는 것을 보장하지는 않음
  * 클라이언트에게 알리지 않고 서버가 요청을 무시하는 경우가 허용됨

  ```
  DELETE /product-list.txt HTTP/1.1
  Host: www.joes-hardware.com
  ```

  ```
  HTTP/1.1 200 OK				[파일 product-list.txt는 서버에서 지워짐]
  Content-Type: text/plain
  Content-Length: 54
  
  I have your delete request,
  will take time to process.
  ```

#### 3.3.9 확장 메서드

* 새로운 기능을 추가해도 과거 구현된 소프트웨어들의 오동작을 유발하지 않음
  * HTTP1.1 명세에 정의되지 않은 메서드
  * 단, 형식을 갖춰야 함
    * 형식을 갖추지 않은 확장 메서드르 ㄹ정의하면 HTTP 어플리케이션 이해하지 못함
  * 그러나
    * 내가 그런것과 별개로 확장 메서드에 관용적인 것이 최고
  * 프락시의 경우
    * 종단 간 행위(ent-to-end)를 망가뜨리지 않으면 알려지지 않은 메서드를 
      곧바로 다운스트림 서버로 전달하려고 시도함
* '(확장메서드는)엄격하게 보내고 관대하게 받아들여라'

| 메서드 | 설명                                                         |
| ------ | ------------------------------------------------------------ |
| LOCK   | 사용자가 리소스를 잠글 수 있음 <br>동시 편집을 막는 용도로 사용됨 |
| MKCOL  | 사용자가 문서를 생성함                                       |
| COPY   | 서버의 리소스를 복사함                                       |
| MOVE   | 서버의 리소스를 옮김                                         |



### 3.4 상태코드

---

* 크게 5가지의 상태코드
  * 1xx ~ 5xx

#### 3.4.1 100-199: 정보성 상태코드

* HTTP 1.1에서 도입된 상태코드

  * 비교족 복잡하여 도입할 가치가 있는지 논란이 있는 것

  | 상태 코드 | 사유 구절           | 의미                                                         |
  | --------- | ------------------- | ------------------------------------------------------------ |
  | 100       | Continue            | 요청의 시작 부분 일부가 받아들여졌음<br>클라이언트는 나머지 요청을  이어 보내야 함 <br>서버는 반드시 응답하라<br>Expect 헤더 |
  | 101       | Switching Protocols | 서버 프로토콜이 클라이언트 요청의 <br />Upgrade 헤더에 나열한 것 중 하나로 바뀌었음 |

##### 클라이언트와 100 Continue

* 최적화를 위한 것
  * 서버가 다루거나 사용할 수 없는 큰 에터티를 서버에게 보내지 않으려는 목적으로 사용
* f만약, 클라이언트가 100 continue 값의 Expect 요청 헤더를 보내고 엔터티를 보내지 않으면 서버는 혼란에 빠진다
* 단, 초창기의 혼란으로 인해
  * 클라이언트는 100 continue를 보내고 서버의 응답이 오지 않으면 타임아웃 후 그냥 엔터티를 보내면 됨
* 단, 서버에서 잘못된 100 Continue 응답을 보내는 경우도 있음
  * 에러를 보내야 하는 데 응답 한다던지

##### 서버와 100 Continue

* 100-continue 값의 Expect 헤더를 요청 받았을 때
  * 만약 클라이언트가 엔터티를 보내버렸다면 상태 코드로 응답하지 않아도 됨
  * 만약 서버가 다 읽은 후 요청이 없다면 상태 코드로 응답을 보내야 함
* 만약 요청을 거부할 때
  * 서버가 응답을 보낸 후 연결을 닫으면 클라이언트는 응답을 받을 수 없음
  * 따라서 기다려야 함(?)

##### 프락시와 100 Continue

* 프락시가 100-continue 값의 요청을 받는 경우
  * 만약, 다음 홉(next-hop) 서버의 버전이 HTTP/1.1보다 낮다는 걸 알고 있다면,
    * 프락시 선에서 417 Expectation Failed 에러로 응답해줘야 함
  * 아니라면, Expect 헤더를 포함해 요청을 전달함
* 프락시가 100-continue 값의 응답을 받는 경우
  * 만약 클라이언트가 HTTP/1.1보다 낮은 버전이면
    * 프락시는 응답을 끊어야 함
* 프락시의 효용
  * 효율적으로 요청을 다룰 수 있음

#### 3.4.2 200-299: 성공 상태 코드

* 대체로 요청은 성공한다

| 상태 코드 | 사유 구절                     | 의미                                                         |
| --------- | ----------------------------- | ------------------------------------------------------------ |
| 200       | OK                            | 리소스 있음                                                  |
| 201       | Created                       | 가장 먼저 개체 생성(예:PUT) <br>구체적 참조가 담긴 Location 헤더 제공<br>리소스 참조하는 여러 URL을 엔터티 본문에 포함 |
| 202       | Accepted                      | 서버에 동작이 일어나지 않응 긍정 응답 <br>요청 내용이 적법하다는 판단<br>본문 요청 상태와 요청 처리 완료 예상 시기를 포함해야 함 |
| 203       | Non-Authoritative Information | 정보가 원래 서버가 아닌 리소스의 사본에서 옴<br>메타 정보(헤더)를 검증하지 못한(혹은 안 한)경우<br>필수가 아님, 선택사항 |
| 204       | No Content                    | 엔터티 본문은 포함하지 않음<br>예: 폼을 리프레시             |
| 205       | Reset Content                 | HTML 폼에 채워진 모든 갑승ㄹ 비워라                          |
| 206       | Partial Content               | 부분 혹은 범위 요청이 성공함 <br>Range 헤더와 같이 범위 요청에 대한 응답<br>Content-Range 와 Date 헤더 반드시 포함<br>Etag와 Content-Location 헤더 중 하나 반드시 포함 |

#### 3.4.3 300-399: 리다이렉션 상태코드

* 클라이언트가 관심있어 하는 리소스에 대해

  * 다른 위치를 사용하라고 말하거나
  * 그 리소스의 내용 대신 다른 대안 응답을 제공

* 리다이렉트 할 수 있는 URL에 대한 링크 + 설명을 포함시키는 것이 좋은 습관

* 리다이렉션 상태코드와 Location 헤더를 보내면

  * 브라우저가 사용자를 귀찮기 하지 않고 알아서 새 위치로 이동함

  ```
  GET /pet-products.txt HTTP/1.1
  Host: www.joes-hardware.com
  Accept: *
  ```

  ```
  HTTP/1.1 301 OK
  Locatoin: http://www.gentle-grooming.com/
  Content-length: 56
  Content-type: text/plain
  
  Please go to our partner site,
  www.gentle-gromming.com
  ```

  ```
  GET /pet-products.txt HTTP/1.1
  Host: www.gentle-gromming.com 		[바뀐 부분, 브라우저에 의해]
  Accept: *
  ```

  ```
  HTTP/1.1 301 OK
  Content-type: text/html
  Content-length: 3307
  
  .....
  ```

* 용례
  * 로컬 복사본이 원래 서버와 비교했을 때 유요한 지 확인함
  * If-Modified_Since 헤더를 전송하여 그 날짜 이후에 수정된 것이 있으면 문서를 가져오고
  * 아니면 서버는 콘텐츠 대신 304 상태 코드로 응답함

  ```
  GET /seasonal/index-fall.html HTTP/1.1
  Host: www.joes-hardware.com
  Accept:*
  If-Modified-Since: Fri, Oct 3 1997 02:16:00 GMT
  ```

  ```
  HTTP/1.1 304 Not Modified
  ...
  ```

| 상태코드 | 사유 구절          | 의미                                                         |
| -------- | ------------------ | ------------------------------------------------------------ |
| 300      | Multiple Choices   | 동시에 여러 리소스를 가리키는 URL 요청한 경우<br>리소스의 목록과 함께 반환 <br>사용자는 목록 중 원하는 하나를 선택함<br>예: 프랑스 / 영어 버전의 HTML 중 하나를 선택 <br>서버가 Location 헤더에 선호하는 URL을 표시할 수 있음 |
| 301      | Moved Permanently  | 요청한 URL이 옮겨졋을 때 사용<br>현재 리소스가 존재하는 URL 포함해야 함 |
| 302      | Found              | 301과 같음 <br>Location 헤더로 주어진 URL로 리소스를 임시로 가리키기 위한 목적으로 사용<br>HTTP/1.0 클라이언트가 POST 요청 보낼 때 |
| 303      | See other          | 302와 같음<br>HTTP1.1 클라이언트가 POST 요청을 보낼 때<br>리소으의 위치를 알려줘 클라이언트는 GET요청으로 따라감 |
| 304      | Not Modified       | 클라이언트가 조건부 요청 시 수정되지 않음을 응답             |
| 305      | Use Proxy          | 반드시 프락시를 거쳐야 함을 의미<br>서버의 모든 리소스가 그런 것은 아님 |
| 307      | Temporary Redirect | 301상태 코드와 유사<br>HTTP1.1 명세에서 302 대신 일시적으로 사용함 |

* 302와 303, 307은 의미가 같음
  * 단, 302는 HTTP/1.0
  * 303과 307은 HTTP/1.1
    * 302,303의 경우 POST요청에 대해 리다이렉트 URL을 제공하며 GET 요청을 유도함

#### 3.4.4 400-499: 클라이언트 에러 상태 코드

* 서버가 알 수 없는 리소스에 대해 요청 받은 경우

| 상태 코드 | 사유 구절                       | 의미                                                         |
| --------- | ------------------------------- | ------------------------------------------------------------ |
| 400       | Bad Request                     | 잘못된 요청을 보냈음                                         |
| 401       | Unauthorized                    | 인증할 것을 요구하는 응답                                    |
| 402       | Payment Required                | 미래에 사용될 가능성이 있음                                  |
| 403       | Forbidden                       | 서버에 의해 거부<br>이유를 엔터티 본문에 포함할 수 있으나<br/>보통 이 경우 이유를 숨기고 싶어 사용함 |
| 404       | Not Found                       | URL을 찾을 수 없음                                           |
| 405       | Method Not Allowed              | 요청 URL에서 지원하지 않는 메서드<br/>요청에 반드시 Allow 헤더가 포함되어야 함 |
| 406       | Not Acceptable                  | 클라이언트의 매개변수에 대해<br/>클라이언트가 받아들일 수 있는 것이 없을 때 사용<br/>종종 헤더에 이유를 포함하기도 함 |
| 407       | Proxy Authentication Required   | 401 상태코드의 프록시 서버 버전                              |
| 408       | Request Timeout                 | 시간이 너무 많이 걸리는 경우<br/>적법한 요청은 어떤 서버라도 충분히 길다 |
| 409       | Conflict                        | 리소스에 대해 일으킬 수 있는 몇 몇 충돌<br/>충돌에 대한 설명이 본문에 포함 |
| 410       | Gone                            | 404와 비슷, 한 때 서버가 리소스를 갖고 있었음                |
| 411       | Length Required                 | Content-Length 헤더를 보내세요                               |
| 412       | Precondition Failed             | 조건부 요청 중 하나가 실패할 때<br/>Expect 헤더에서 조건부 요청 포함 |
| 413       | Request Entity Too Large        | 서버의 한계를 넘은 크기의 요청                               |
| 414       | Request URI Too Long            | 서버의 한계를 넘은 길이의 요청 URL                           |
| 415       | Unsupported Media Type          | 서버가 이해하거나 지원하지 못하는 내용의 엔터티 유형         |
| 416       | Requested Range Not Satisfiable | 리소스의 특정 범위 요청 시<br/>범위가 맞지 않거나 잘못되었을 떄 |
| 417       | Expectation Failed              | Expect 요청 헤더에 <br/>서버가 만족시킬 수 없는 기대가 있을 때 |

#### 3.4.5 500-599: 서버 에러 상태 코드

* 서버 자체에서 에러가 발생하는 경우
  * 클라이언트가 서버 제한에 걸리거나
  * 게이트웨이 리소스와 같은 서버 보조 구성요소에서 발생
* 프락시가 에러를 만나면 스스로 5XX 서버 에러 상태 코드를 생성함

| 상태 코드 | 사유 구절                  | 의미                                                         |
| --------- | -------------------------- | ------------------------------------------------------------ |
| 500       | Internal Server Error      | 서버가 요청을 처리할 수 없게 만드는 에러                     |
| 501       | Not Implemented            | 서버의 능력을 넘은 요청 <br>예:  서버가 지원하지 않는 메서드 |
| 502       | Bad Gateway                | 요청 응답 연쇄에서 가짜 응답에 맞닥드렸을 때<br>자신의 부모 게이트웨이에 접속이 불가능할 때 |
| 503       | Service Unavailable        | 현재 서버는 불가능하지만 나중에는 가능함<br/>Retry-AFter 헤더를 통해 예정 기간 제공 가능 |
| 504       | Gateway Timeout            | 408과 유사, 게이트웨이와 프록시 버전                         |
| 505       | HTTP Version Not Supported | 버전 관리                                                    |



### 3.5 헤더

---

* 5가지 헤더 종류
  * 일반 헤더: 양쪽 모두가 사용함
    * Date: Tue, 3 Oct 1974 02:16:00 GMT
  * 요청 헤더: 요청 메시지
    * Accept: * / *
  * 응답 헤더: 클라이언트에게 정보를 제공하기 위한 자신만의 헤더
    * Server: Tiki-Hut/1.0
  * 엔터티 헤더: 본문에 대한 헤더
    * Content-Type: text/html; charset=iso-latin-1
  * 확장 헤더
    * 비표준 헤더

#### 3.5.1 일반 헤더

* 메시지가 어떤 종류이든 상관없이 유용한 정보를 제공

  | 헤더                     | 설명                                                         |
  | ------------------------ | ------------------------------------------------------------ |
  | Connection               | 클라이언트와 서버의 연결 옵션                                |
  | Date                     | 메시지가 만들어진 날짜와 시간                                |
  | MIME-Version             | 멀티미디어, MIME의 버전                                      |
  | Trailer chunked transfer | chunk로 인코딩된 메시지의<br/>끝 부분에 위치한 헤더들의 목록 |
  | Transfer-Encoding        | 인코딩의 종류를 알려줘 안전하게 전송                         |
  | Upgrade                  | 발신자가 업그레이드하길 원하는 새 버전/프로토콜              |
  | Via                      | 메시지가 어떤 중개자(프록시,게이트웨이)를 거쳐 왔는지        |

  

##### 일반 캐시 헤더

* 매번 원 서버로부터 객체를 가져오는 대신 로컬 복사본으로 캐시할 수 있음

  | 헤더          | 설명                                                         |
  | ------------- | ------------------------------------------------------------ |
  | Cache-Control | 메시지와 캐시 지시자를 전달하기 위해 사용                    |
  | Pragma        | 메시지와 지시자를 전달하는 또 다른 방법, 캐시 외에도 사용 가능 |

  * Pragma는 엄밀히 말하면 '요청 헤더'
  * 단 곧 Cache-Control로 대체될 예정

#### 3.5.2 요청 헤더

* 클라이언트가 누구인지, 선호, 능력에 대한 정보를 줌

  | 헤더       | 설명                                           |
  | ---------- | ---------------------------------------------- |
  | Client-IP  | 클라이언트 컴퓨터의 IP                         |
  | From       | 클라이언트 사용자의 메일 주소                  |
  | Host       | 요청의 대상이 되는 서버의 호스트 명과 포트     |
  | Referer    | 현재의 요청 URI가 들어있던 문서의 URL          |
  | UA-Color   | 클라이언트 기기 디스플레이의 색상 능력 정보    |
  | UA-CPU     | 클라이언트 CPU의 종류, 제조사                  |
  | UA-Disp    | 클라이언트 디스플레이 능력에 대한 정보         |
  | UA-OS      | 클라이언트 기기에서 동작 중인 OS의 이름과 버전 |
  | UA-Pixels  | 클라이언트 디스플레이에 대한 픽셀 정보         |
  | User-Agent | 요청을 보낸 애플리케이션의 이름                |

##### Accept 관련 헤더

* 서버에게 자신의 선호와 능력을 알려 주는 헤더

  * 원하는 것과 원하지 않는 것을 알려 줌

  * 양쪽 모두에게 유익함

  * 서버의 대역폭과 시간을 낭비하지 않음

    | 헤더            | 설명                            |
    | --------------- | ------------------------------- |
    | Accept          | 서버가 보내도 되는 미디어 종류  |
    | Accept-Charset  | 서버가 보내도 되는 문자집합     |
    | Accept-Encoding | 서버가 보내도 되는 인코딩       |
    | Accept-Language | 서버가 보내도 되는 언어         |
    | TE              | 서버가 보내도 되는 확장전송코딩 |

##### 조건부 요청 헤더

* 클라이언트가 제약을 넣은 요청

  | 헤더                | 설명                                                      |
  | ------------------- | --------------------------------------------------------- |
  | Expect              | 요청에 필요한 서버의 행동을 열거                          |
  | IF-Match            | 문서 엔터티 태그가 주어진 태그와 일치하면 가져오기        |
  | IF-Modified-Since   | 주어진 날짜 이후 리소스 변경이 없으면 요청 제한           |
  | If-None-Match       | 문서 엔터티 태그와 주어진 태그가 일치하지 않으면 가져오기 |
  | If-Range            | 문서 특정 범위에 대한 요청                                |
  | If-Unmodified-Since | 주어진 날짜 이후 리소스 변경이 있으면 요청 제한           |
  | Range               | 범위 요청을 지원한다면 리소스의 특정 범위 요청            |

##### 요청 보안 헤더

* 요청을 위한 간단한 인증요구/응답 체계

  | 헤더          | 설명                                                         |
  | ------------- | ------------------------------------------------------------ |
  | Authorization | 서버에게 제공하는 인증정보                                   |
  | Cookie        | 클라이언트가 서버에게 토큰을 전달할 때 사용<br/>진짜 보안 헤더는 아니지만 보안에 영향을 줄 수 있음 |
  | Cookie2       | 요청자가 지원하는 쿠키의 버전 알려줄 때 사용                 |

##### 프락시 요청 헤더

*  프락시가 흔해지며 헤더들이 더 등장함

  | 헤더                | 설명                                                         |
  | ------------------- | ------------------------------------------------------------ |
  | Max-Forwards        | 프록시, 게이트웨이로 전달될 수 있는 최대 횟수<br/>TRACE 메서드와 함께 사용 |
  | Proxy-Authorization | Authorizaion 프락시 버전                                     |
  | Proxy-Connection    | Connection 프락시 버전                                       |

#### 3.5.3 응답 헤더

* 누가 응답을 보내는 지, 능력은 어떻게 되는지, 응답의 설명까지 제공

  | 헤더        | 설명                                          |
  | ----------- | --------------------------------------------- |
  | Age         | 응답이 얼마나 오래되었는지                    |
  | Public      | 특정 리소스에 대해 지원하는 메서드 목록       |
  | Retry-After | 리소스 사용 불가에서 가능해지는 날짜 및 기간  |
  | Server      | 서버 어플리케이션의 이름과 버전               |
  | Title       | HTML 문서의 제목                              |
  | Warning     | 사유 구절에 있는 것보다 더 자세한 경고 메시지 |

  

##### 협상 헤더

* 여러 가지 표현이 가능한 상황에서 협상 기능을 지원함

  * 프랑스어 HTML vs 독일어HTML

  | 헤더          | 설명                                                         |
  | ------------- | ------------------------------------------------------------ |
  | Accept-Ranges | 서버가 자원에 대해 받아들이 수 있는 범위                     |
  | Vary          | 서버가 확인해 보아야 하고 응답에 영향을 줄 수 있는 헤더 목록 |

##### 응답 보안 헤더

* 인증 요구 헤더

  | 헤더               | 설명                                                         |
  | ------------------ | ------------------------------------------------------------ |
  | Proxy-Authenticate | 프락시에서 클라이언트로 보내는 인증요구 목록                 |
  | Set-Cookie         | 진짜 보안헤더는 아니지만 보안에 영향을 줄 수 있음<br/>서버가 클라이언트를 인증하도록 토큰을 설정함 |
  | Set-Cookie2        | Set-Cookie와 유사                                            |
  | WWW-Authenticate   | 서버에서 클라이언트로 보낸 인증요구 목록                     |

#### 3.5.4 엔터티 헤더

* 엔터티, 그것의 내용물, 개체의 타입, 요청 가능한 유효 메서드 등의 광범위한 정보 제공

##### 정보 헤더

| 헤더     | 설명                                          |
| -------- | --------------------------------------------- |
| Allow    | 이 엔터티에 대해 수행될 수 있는 요청 메서드   |
| Location | 엔터티가 실제로 어디에 위치하고 있는지 말해줌 |

##### 콘텐츠 헤더

| 헤더             | 설명                                                      |
| ---------------- | --------------------------------------------------------- |
| Content-Base     | 본문에서 사용된 상대 URL 계산을 위한 기저 URL             |
| Content-Encoding | 본문에 적용된 어떤 인코딩                                 |
| Content-Language | 본문을 이해하는 데 가장 적절한 자연어                     |
| Content-Length   | 본문의 길이나 크기                                        |
| Content-Location | 리소스가 실제 위치하는 곳                                 |
| Content-MD5      | 본문의 MD5 체크섬                                         |
| Content-Range    | 전체 리소스에서 엔터티가 해당하는 범위의 바이트 단위 표현 |
| Content-Type     | 어떤 종류의 객체인지                                      |

##### 엔터티 캐싱 해더

* 언제 어떻게 캐시가 되어야 하는지에 대한 지시자를 제공
  * 캐시된 사본이 아직 유효한가?
  * 캐시된 리소스가 유효하지 않게 된 시점은 언제인가?

| 헤더          | 설명                                                  |
| ------------- | ----------------------------------------------------- |
| ETag          | 엔터티에 대한 엔터티 태그                             |
| Expires       | 엔터티가 유효하지 않아 원본을 다시 받아와야 하는 일시 |
| Last-MOdified | 가장 최근 이 엔터티가 변경된 일시                     |



