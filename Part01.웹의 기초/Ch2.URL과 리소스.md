# URL 구조

![URL 기본 구조](https://cdn.shortpixel.ai/client/q_glossy,ret_img,w_3157/https://anthonyknaape.com/wp-content/uploads/2018/10/URL-Structure-Domain-Name.jpg)

URL의 첫 부분은 `스킴(scheme)`이다. 웹 클라이언트가 리소스에 접근하는 방법, `프로토콜`을 의미한다.

URL의 두 번째 부분은 `도메인 이름`이다. `서버의 위치`라고도 할 수 있는데, 리소스가 어디에 호스팅되어 있는지 알려 준다.

URL의 세 번째 부분은 `리소스 경로`다. 서버에 존재하는 `로컬 리소스들` 중에서 요청받은 리소스가 무엇인지 알려 준다.



# URL 문법

URL을 통해 인터넷상의 모든 리소스를 찾을 수 있다. 리소스들은 다른 스킴(http, ftp, smtp 등)을 통해 접근할 수 있으며, URL 문법은 스킴에 따라서 달라 진다. 스킴에 따라 달라지긴 하지만 형태와 문법 면에서 서로 매우 유사한 구조를 가진다.

`<스킴>://<사용자 이름>:<비밀번호>@<호스트>:<포트>/<경로>;<파라미터>?<질의>#<프래그먼트>`

대부분의 URL 스킴 문법은 위와 같은 구조를 가진다. 이 모든 요소를 가진 URL은 거의 없고 가장 주요한 세 가지 요소인 `스킴`, `호스트`, `경로`를 가진 형태가 많다.



## 스킴: 사용할 프로토콜

주어진 리소스에 `접근하는 방법`이다. 리소스를 요청하기 위해 어떤 `프로토콜`을 사용해야 하는지 알려 준다.



## 호스트 & 포트

애플리케이션이 리소스를 찾기 위해서는 리소스를 `호스팅`하고 있는 장비와 그 장비 내에서 리소스에 접근할 수 있는 `서버`가 어디에 있는지 알아야 한다. `호스트`와 `포트`는 이 정보를 제공해준다.

보통의 경우 `호스트`는 도메인 이름 형태로 나타나는 경우가 많다. 서버 컴퓨터의 `IP주소`를 통해서도 참조할 수 있지만 외우기도 어려울 뿐더러 직관적이지 않기 때문에 잘 사용하지 않는다. 호스트는 `서버 컴퓨터를 참조하기 위한 이름` 정도로 생각하면 될 것 같다.

`포트`는 서버가 열어놓은 `네트워크 포트`를 가리킨다. 내부적으로 TCP 프로토콜을 사용하는 HTTP는 기본 포트로 `80`을 사용한다.



## 사용자 이름 & 비밀번호

많은 서버가 리소스에 접근을 허용하기 전에 `사용자 이름`과 `비밀번호`를 요구한다. `FTP`서버가 좋은 예다.

`ftp://ftp.prep.ai.mit.edu/pub/gnu`

`사용자 이름`이나 `비밀번호` 컴포넌트가 없는 형태다. 이런 경우 기본값이 할당된다. 기본 사용자 이름 값으로 `anonymous`가, 비밀번호는 브라우저마다 가지고 있는 기본값이 다르다.



## 경로

리소스가 서버의 어디에 있는지 알려 준다. 해당 경로는 아래 예와 같이 `계층적 파일 시스템 경로`와 유사한 구조를 가진다.

`http:www.joes-hardware.com:80/seasonal/index-fall.html`

이 URL의 경로는 `/seasonal/index-fall.html`로 유닉스 파일 시스템의 파일 경로와 유사하다. 경로 컴포넌트는 `/` 문자를 기준으로 `경로조각`으로 나뉘며 각 경로조각은 자체만의 `파라미터` 컴포넌트를 가질 수 있다.



## 파라미터

애플리케이션이 서버에 더 정확한 요청을 하기 위해 필요한 추가적인 정보들을 담는 컴포넌트이다. 리소스의 타입, 정보 등이 해당된다.

`ftp://prep.ai.mit.edu/pub;graphics=true/gnu;type=d`

파타미터는 위와 같이 `key/value` 형태를 가지고 경로조각마다 가질 수 있다.



## 질의 문자열

요청받을 리소스 형식의 범위를 좁히기 위해서 질문이나 질의를 URL에 포함해 요청할 수 있다. 다른 말로는 `query string`이라고 하는데 단순하게 이해하면 가져올 데이터의 조건들을 설정할 수 있다. 질의 문자열은 `?` 문자 다음에 오며 각 질의 문자열은 `&` 문자로 구분한다. 파라미터와 동일하게 `key/value` 형태를 가진다.

`http://www.joes-hardware.com/inventory-check.cgi?item=12731&color=blue`

위 URL에는 두 가지의 질의 문자열이 있다. `item=12731`과 `color=blue`가 그것이다. 가져올 리소스 중 아이템 번호가 `12731`이고 색상이 `blue`인 리소스의 데이터를 요청하는 질의 문자열이다.



## 프래그먼트

가져올 리소스 객체의 일부분만을 보고 싶을 때 사용한다. 하지만 HTTP 서버는 항상 `전체 객체`만을 다루기 때문에 클라이언트는 서버로부터 먼저 `전체 리소스 객체`를 가져온 후 사용자가 요청한 프래그먼트에 해당하는 부분을 추출하여 사용자에게 보여준다.

`http://www.joes-hardware.com/tools.html#drills`

> 먼저 `tools.html` 전체 파일을 가져온 후 `drills` 프래그먼트에 해당하는 부분을 사용자에게 보여준다.



# 단축 URL

웹 클라이언트는 몇몇 `단축 URL`을 인식하고 사용한다. 여기서는 `상대 URL`과 `URL 확장`에 대해서 알아보자.



## 상대 URL

지금까지 우리가 본 URL은 모두 `절대 URL`이었다. `절대 URL`은 리소스에 접근하는 데에 필요한 모든 정보를 가지고 있다.

반면에, `상대 URL`은 모든 정보를 담고 있지는 않다. `상대 URL`을 통해 모든 정보를 얻기 위해서는 `기저(base)`라고 하는 다른 URL을 사용해야 한다. 다음은 `상대 URL`의 한 예이다.

```html
<a href="./hammers.html">hammers</a>
```

상대 URL은 `문서의 URL`을 기준으로 해석될 수 있다. 위 경우는 a태그가 위치한 html파일과 동일한 디렉토리 내의 파일을 탐색한다는 뜻이다. 자세한 건 [여기](http://webberstudy.com/html-css/html-1/basic-knowledge/)를 참조하자.



### 기저 URL 찾기



#### 리소스에서 명시적으로 제공

어떤 리소스들은 기저 URL을 명확하게 기술하기도 한다. 예를 들어 HTML 문서에서는 그 안에 있는 모든 상대 URL을 변경하기 위해서 기저 URL을 가리키는 `<BASE>` HTML 태그를 기술할 수 있다.



#### 리소스를 포함하고 있는 기저 URL

위의 예처럼 기저 URL이 명시되지 않은 리소스에 포함된 경우, `해당 리소스의 URL`이 기저 URL로 사용된다.



#### 기저 URL이 없는 경우

기저 URL이 없는 경우도 있다. 보통 이런 경우는 `절대 URL`로만 이루어져 있다는 뜻이다. 간혹 불완전하거나 깨진 URL일 수 있다.



### 상대 참조 해석하기

기저 URL을 찾았다면 `상대 URL`을 `절대 URL`로 변환하는 과정이 필요하다. 앞서 보았던 URL의 기본 문법에 따라 `상대 URL`과 `기저 URL`을 각각의 컴포넌트 조각으로 나눈다. 위의 예를 이용해서 과정을 살펴보자.

> 1. 경로는 `.hammers.html` 기저 URL은 `http://www.joes-hardware.com/tools.html`
> <br>
> 2. `.hammers.html`을 보면 스킴 부분이 비어 있다. 기저 URL의 스킴(http)을 상속받는다.
> <br>
> 3. 적어도 한 개의 컴포넌트를 가지고 있기 때문에 `호스트`와 `포트` 컴포넌트를 상속받는다. 컴포넌트가 한 개도 없을 경우 동작하지 않는다.
> <br>
> 4. 상대 URL 컴포넌트와 상속받은 컴포넌트를 합치면 새로운 절대 URL을 얻을 수 있다.
>
> `http://www.joes-hardware.com/hammers.html`



## URL 확장

어떤 브라우저들은 URL을 입력한 다음이나 입력하고 있는 동안 자동으로 URL을 확장한다. 따라서 사용자는 URL 전체를 입력하지 않아도 된다. 이러한 확장 기능은 두 가지로 나뉜다.



### 호스트 명 확장

호스트 명 확장 기능을 지원하는 브라우저는 단순한 휴리스틱만을 사용해서 입력한 호스트 명을 전체 호스트 명으로 확장시킬 수 있다.

예를 들어 주소란에 `naver`를 입력하면 브라우저는 호스트 명에 자동으로 `www.`와 `.com`을 붙여서 `www.naver.com`을 만든다. 만약 해당 단어를 포함한 사이트를 찾지 못하면 확장을 포기하기 전에 유사한 다른 URL을 추가로 제시한다.

이 기능을 통해 사용자는 시간을 절약할 수 있지만 호스트 명 확장 기능은 프락시와 같은 다른 HTTP 어플리케이션에 혼란을 줄 수 있다.



### 히스토리 확장

사용자가 이전에 방문했던 URL의 `기록`을 토대로 완결된 URL을 제시한다.



# 안전하지 않은 문자

URL 설계자들은 정보의 유실 위험 없이 URL을 전송하고자 알파벳 이외의 문자들은 URL에 사용하지 못하도록 했었다. 하지만 사용자들이 URL에 이진 데이터나 알파벳 외의 문자들도 포함하려는 경우가 생겼다. 그래서 `이스케이프`라는 기능을 추가하여 안전하지 않은 문자를 안전한 문자로 `인코딩`할 수 있게 하였다.



## URL 문자 집합

역사적으로 많은 컴퓨터 애플리케이션이 `US-ASCII` 문자 집합을 사용해왔다. 하지만 다른 언어들과 이진 데이터들을 포함하기에는 너무 적은 수의 문자만을 포함하고 있었기 때문에 URL 설계자들은 URL에 `이스케이프` 문자열을 쓸 수 있게 설계하였다. `이스케이프 문자열`은 특정 문자나 데이터를 인코딩할 수 있게 함으로써 이동성과 완성도를 높였다.



## 인코딩 체계

인코딩이 이루어질 때, 안전하지 않은 문자를 `%` 기호로 시작해 ASCII 코드로 표현되는 두 개의 16진수 숫자로 이루어진 `이스케이프` 문자로 바꾸는 방식이 사용된다.

`~` => `%7E`
`빈 문자` => `%20`
`%` => `%25`



## 문자 제한

몇몇 문자는 URL 내에서 특별한 의미로 예약되어 있기 때문에 본래 목적이 아닌 다른 용도로 사용하기 위해서는 인코딩해서 사용해야 한다.



#### 참고

[이미지 출처](https://anthonyknaape.com/why-is-the-url-important/)